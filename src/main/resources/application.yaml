#
# Copyright (c) 2025. Netz AI GmbH <https://netz-ai.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
  application:
    name: aws-controller-java
  config:
    # Load key=value from local .env if present
    import: optional:file:/home/hanif/IdeaProjects/aws-controller-java/.env[.properties]
#  data:
#    rest:
#      base-path: /api
  datasource:
    url: ${DB_URL:jdbc:mariadb://127.0.0.1:3306/aws-controller?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC}
    username: ${DB_USERNAME:aws_hanif}
    password: ${DB_PASSWORD:aws-secret}
    driver-class-name: org.mariadb.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000
  devtools:
    add-properties: false
  jpa:
    hibernate:
      ddl-auto: update           # Schema managed by Flyway
      naming:
        implicit-strategy: org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyHbmImpl
    properties:
      hibernate:
        format_sql: true
        jdbc.time_zone: UTC
        show_sql: true
        dialect: org.hibernate.dialect.MariaDBDialect
        boot:
          allow_jdbc_metadata_access: true
    open-in-view: false
    database: mysql
  sql:
    init:
      mode: never

  # -- Run Configuration
  jvm:
    argument: -Djdk.attach.allowAttachSelf=true -XX:+EnableDynamicAgentLoading
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: true
  servlet:
    multipart:
      max-file-size: 1MB
      max-request-size: 1MB

server:
  port: ${SERVER_PORT:8080}
  shutdown: graceful
#  servlet:
#    context-path: /api/v1
  address: ${SERVER_ADDRESS:127.0.0.1}
  compression:
    enabled: true
  http2:
    enabled: true

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when_authorized
  metrics:
    tags:
      application: ${spring.application.name}
  observations:
    key-values:
      env: ${APP_ENV:default}

logging:
  level:
    org:
      springframework.boot.context.config: debug
    root: warn
#    org.springframework.security: info
    org.hibernate.SQL: debug    # Turn to INFO in prod
    com.netz_ai.aws_controller: debug
    tomcat: error
  register-shutdown-hook: false
  logback:
    rollingpolicy:
      max-file-size: 1MB
      total-size-cap: 10MB
      clean-history-on-start: true
      max-history: 9
  pattern:
    console: "%d{yyyy-MM-dd'T'HH:mm:ss.SSSXXX} %-5level [%X{traceId:-}-[%X{spanId:-}]] %logger{36} - %msg%n"
  file:
    name: log/aws_controller.log
    path: log/

# Swagger UI at /swagger-ui.html
#springdoc:
#  swagger-ui:
#    path: /swagger-ui.html
#  api-docs:
#    enabled: true
#    path: /openapi

# JWT & security (used by SecurityConfig / TokenService)
#security:
#  jwt:
#    issuer: ${JWT_ISSUER:aws-controller}
#    secret: ${JWT_SECRET:please-change-in-prod}
#    access-token:
#      ttl: ${JWT_ACCESS_TTL:PT15M}      # ISO-8601 duration
#    refresh-token:
#      ttl: ${JWT_REFRESH_TTL:P7D}

# CORS defaults (can be tightened per env)
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000}
  allowed-methods: GET,POST,PUT,PATCH,DELETE,OPTIONS
  allowed-headers: "*"
  allow-credentials: true

aws:
  access_key_id: ${AWS_ACCESS_KEY_ID}
  secret_access_key: ${AWS_SECRET_ACCESS_KEY}

#aws_controller:
#  seed:
#    enabled: true
#    admin:
#      username: admin
#      email: admin@example.com
#      password: P@ssw0rd!
#    client:
#      enabled: true
#      id: svc_bootstrap
#      name: Bootstrap Client

